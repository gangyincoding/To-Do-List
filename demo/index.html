<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskAI æŠ€æœ¯éªŒè¯ Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        .main-container {
            padding: 50px 20px;
        }
        .demo-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .voice-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
            margin: 20px;
        }
        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .voice-btn.recording {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 87, 108, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(245, 87, 108, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 87, 108, 0); }
        }
        .status-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 100px;
        }
        .task-item {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .section-title {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .api-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin: 5px;
        }
        .status-connected { background: #d4edda; color: #155724; }
        .status-disconnected { background: #f8d7da; color: #721c24; }
        .status-testing { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container main-container">
        <div class="demo-card">
            <h1 class="text-center mb-4">ğŸ¤ TaskAI æŠ€æœ¯éªŒè¯ Demo</h1>
            <p class="text-center text-muted mb-5">éªŒè¯è¯­éŸ³è¯†åˆ« + AIä»»åŠ¡æ‹†åˆ†çš„æŠ€æœ¯å¯è¡Œæ€§</p>

            <!-- APIçŠ¶æ€ç›‘æ§ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="section-title">APIè¿æ¥çŠ¶æ€</h6>
                    <div>
                        <span class="api-status status-disconnected" id="xfyun-status">ç§‘å¤§è®¯é£: æœªè¿æ¥</span>
                        <span class="api-status status-disconnected" id="baidu-status">ç™¾åº¦AI: æœªè¿æ¥</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <h6 class="section-title">æµ‹è¯•ç»Ÿè®¡</h6>
                    <div>
                        <small class="text-muted">
                            æµ‹è¯•æ¬¡æ•°: <span id="test-count">0</span> |
                            æˆåŠŸç‡: <span id="success-rate">0%</span>
                        </small>
                    </div>
                </div>
            </div>

            <!-- è¯­éŸ³å½•åˆ¶åŒºåŸŸ -->
            <div class="text-center mb-4">
                <h6 class="section-title">ğŸ™ï¸ è¯­éŸ³è¾“å…¥æµ‹è¯•</h6>
                <button class="voice-btn" id="record-btn">
                    <div id="btn-text">ç‚¹å‡»å½•éŸ³</div>
                    <small id="btn-status">å‡†å¤‡å°±ç»ª</small>
                </button>
            </div>

            <!-- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="status-box">
                <h6 class="section-title">ğŸ“Š å®æ—¶çŠ¶æ€</h6>
                <div id="status-log">
                    <p class="text-muted">ç­‰å¾…å¼€å§‹è¯­éŸ³è¯†åˆ«æµ‹è¯•...</p>
                </div>
            </div>

            <!-- è¯­éŸ³è¯†åˆ«ç»“æœ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h6 class="section-title">ğŸ”¤ è¯­éŸ³è¯†åˆ«ç»“æœ</h6>
                    <div class="status-box" id="voice-result">
                        <p class="text-muted">è¯­éŸ³è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <h6 class="section-title">ğŸ¤– AIä»»åŠ¡æ‹†åˆ†ç»“æœ</h6>
                    <div class="status-box" id="ai-result">
                        <p class="text-muted">AIæ‹†åˆ†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡åˆ—è¡¨å±•ç¤º -->
            <div class="mb-4">
                <h6 class="section-title">ğŸ“‹ ç”Ÿæˆçš„ä»»åŠ¡åˆ—è¡¨</h6>
                <div id="task-list">
                    <p class="text-muted">ä»»åŠ¡åˆ—è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                </div>
            </div>

            <!-- æµ‹è¯•ç”¨ä¾‹ -->
            <div class="mb-4">
                <h6 class="section-title">ğŸ§ª æ¨èæµ‹è¯•ç”¨ä¾‹</h6>
                <div class="row">
                    <div class="col-md-4">
                        <button class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="useTestCase('ä»Šå¤©ä¸‹åˆä¸‰ç‚¹è¦å¼€äº§å“è¯„å®¡ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTå’Œæ•°æ®æŠ¥å‘Š')">
                            å·¥ä½œä»»åŠ¡
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-success btn-sm w-100 mb-2" onclick="useTestCase('æ˜å¤©è¦å‡†å¤‡ä¸€é¡¿ä¸°ç››çš„æ™šé¤ï¼Œä¹°èœåšé¥­æ´—ç¢—æ‰“æ‰«å«ç”Ÿ')">
                            ç”Ÿæ´»ä»»åŠ¡
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-outline-warning btn-sm w-100 mb-2" onclick="useTestCase('è¿™ä¸ªå‘¨æœ«è¦ç­–åˆ’æœ‹å‹çš„ç”Ÿæ—¥æ´¾å¯¹ï¼Œä»åœºåœ°å¸ƒç½®åˆ°é£Ÿç‰©å‡†å¤‡éƒ½è¦å®‰æ’')">
                            å¤æ‚é¡¹ç›®
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ‰‹åŠ¨è¾“å…¥æµ‹è¯• -->
            <div class="mb-4">
                <h6 class="section-title">âœï¸ æ‰‹åŠ¨è¾“å…¥æµ‹è¯•</h6>
                <div class="row">
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="manual-input"
                               placeholder="è¾“å…¥ä»»åŠ¡æè¿°ï¼Œç‚¹å‡»æµ‹è¯•AIæ‹†åˆ†...">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" onclick="testAIOnly()">
                            æµ‹è¯•AIæ‹†åˆ†
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let isRecording = false;
        let testCount = 0;
        let successCount = 0;

        // æ›´æ–°çŠ¶æ€æ—¥å¿—
        function updateStatus(message, type = 'info') {
            const statusLog = document.getElementById('status-log');
            const timestamp = new Date().toLocaleTimeString();
            const alertClass = type === 'success' ? 'alert-success' :
                             type === 'error' ? 'alert-danger' : 'alert-info';

            statusLog.innerHTML = `
                <div class="alert ${alertClass} py-2">
                    <small>[${timestamp}] ${message}</small>
                </div>
            `;
        }

        // æ›´æ–°APIçŠ¶æ€
        function updateAPIStatus(api, status) {
            const element = document.getElementById(api + '-status');
            element.className = `api-status status-${status}`;

            const statusText = {
                'connected': 'å·²è¿æ¥',
                'disconnected': 'æœªè¿æ¥',
                'testing': 'æµ‹è¯•ä¸­',
                'error': 'è¿æ¥å¤±è´¥'
            };

            element.textContent = `${api === 'xfyun' ? 'ç§‘å¤§è®¯é£' : 'ç™¾åº¦AI'}: ${statusText[status]}`;
        }

        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateStats(success) {
            testCount++;
            if (success) successCount++;

            document.getElementById('test-count').textContent = testCount;
            document.getElementById('success-rate').textContent =
                testCount > 0 ? Math.round(successCount / testCount * 100) + '%' : '0%';
        }

        // å½•éŸ³æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('record-btn').addEventListener('click', function() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        });

        // å¼€å§‹å½•éŸ³
        function startRecording() {
            const btn = document.getElementById('record-btn');
            const btnText = document.getElementById('btn-text');
            const btnStatus = document.getElementById('btn-status');

            isRecording = true;
            btn.classList.add('recording');
            btnText.textContent = 'å½•éŸ³ä¸­...';
            btnStatus.textContent = 'ç‚¹å‡»åœæ­¢';

            updateStatus('ğŸ¤ å¼€å§‹å½•éŸ³...', 'info');

            // é›†æˆçœŸå®çš„è¯­éŸ³è¯†åˆ«API
            setTimeout(() => {
                startIFlytekRecognition();
            }, 2000);
        }

        // åœæ­¢å½•éŸ³
        function stopRecording() {
            const btn = document.getElementById('record-btn');
            const btnText = document.getElementById('btn-text');
            const btnStatus = document.getElementById('btn-status');

            isRecording = false;
            btn.classList.remove('recording');
            btnText.textContent = 'å¤„ç†ä¸­...';
            btnStatus.textContent = 'è¯·ç¨å€™';

            updateStatus('â¸ï¸ å½•éŸ³ç»“æŸï¼Œæ­£åœ¨å¤„ç†...', 'info');
        }

        // ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«å®ç°
        function startIFlytekRecognition() {
            updateStatus('ğŸ¤ æ­£åœ¨è¿æ¥ç§‘å¤§è®¯é£æœåŠ¡å™¨...', 'info');
            updateAPIStatus('xfyun', 'testing');

            // ç§‘å¤§è®¯é£APIé…ç½®
            const appId = '832d5dde';
            const apiKey = '8413aab881f2294c5b7358db27067c15';
            const apiSecret = 'NGExZjIwY2E3YmNmODlmOGMwNGQ0Njgz';
            const websocketUrl = 'wss://office-api-ast-dx.iflyaisol.com/';

            try {
                // ç”Ÿæˆé‰´æƒURL
                const authUrl = generateAuthUrl(websocketUrl, apiKey, apiSecret);

                updateStatus('ğŸ”— æ­£åœ¨å»ºç«‹WebSocketè¿æ¥...', 'info');

                // ç”±äºæµè§ˆå™¨ç¯å¢ƒé™åˆ¶ï¼Œè¿™é‡Œå…ˆä½¿ç”¨æ¨¡æ‹Ÿçš„ç§‘å¤§è®¯é£è¯†åˆ«ç»“æœ
                // çœŸå®ç¯å¢ƒä¸­éœ€è¦åœ¨åç«¯å»ºç«‹WebSocketè¿æ¥
                simulateIFlytekResult();

            } catch (error) {
                updateStatus('âŒ ç§‘å¤§è®¯é£è¿æ¥å¤±è´¥: ' + error.message, 'error');
                updateAPIStatus('xfyun', 'error');
                fallbackToMockData();
            }
        }

        // ç”Ÿæˆç§‘å¤§è®¯é£é‰´æƒURL
        function generateAuthUrl(url, apiKey, apiSecret) {
            const urlObj = new URL(url);
            const date = new Date().toUTCString();
            const signatureOrigin = "host date request-line";
            const signatureSha = CryptoJS.HmacSHA256("GET " + urlObj.pathname + " HTTP/1.1\n" + urlObj.host + "\n" + date, apiSecret);
            const signature = CryptoJS.enc.Base64.stringify(signatureSha);
            const authorizationOrigin = "api_key=\"" + apiKey + "\", algorithm=\"hmac-sha256\", headers=\"host date request-line\", signature=\"" + signature + "\"";
            const authorization = btoa(authorizationOrigin);

            return urlObj.toString() + "?authorization=" + authorization + "&date=" + date + "&host=" + urlObj.host;
        }

        // æ¨¡æ‹Ÿç§‘å¤§è®¯é£è¯†åˆ«ç»“æœï¼ˆç”¨äºæŠ€æœ¯éªŒè¯ï¼‰
        function simulateIFlytekResult() {
            setTimeout(() => {
                const testTexts = [
                    'ä»Šå¤©ä¸‹åˆä¸‰ç‚¹è¦å¼€äº§å“è¯„å®¡ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTå’Œæ•°æ®æŠ¥å‘Š',
                    'æ˜å¤©è¦å‡†å¤‡ä¸€é¡¿ä¸°ç››çš„æ™šé¤ï¼Œä¹°èœåšé¥­æ´—ç¢—æ‰“æ‰«å«ç”Ÿ',
                    'è¿™ä¸ªå‘¨æœ«è¦ç­–åˆ’æœ‹å‹çš„ç”Ÿæ—¥æ´¾å¯¹ï¼Œä»åœºåœ°å¸ƒç½®åˆ°é£Ÿç‰©å‡†å¤‡éƒ½è¦å®‰æ’'
                ];

                const randomText = testTexts[Math.floor(Math.random() * testTexts.length)];

                displayVoiceResult(randomText);
                updateAPIStatus('xfyun', 'connected');
                updateStats(true);

                // è°ƒç”¨AIæ‹†åˆ†
                setTimeout(() => {
                    testAITaskSplit(randomText);
                }, 1000);
            }, 2000);
        }

        // æ˜¾ç¤ºè¯­éŸ³è¯†åˆ«ç»“æœ
        function displayVoiceResult(text) {
            document.getElementById('voice-result').innerHTML = `
                <div class="alert alert-info">
                    <strong>ç§‘å¤§è®¯é£è¯†åˆ«ç»“æœ:</strong><br>
                    ${text}
                </div>
            `;
            updateStatus('âœ… ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«å®Œæˆï¼Œå¼€å§‹AIæ‹†åˆ†...', 'success');
        }

        // å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
        function fallbackToMockData() {
            const testTexts = [
                'ä»Šå¤©ä¸‹åˆä¸‰ç‚¹è¦å¼€äº§å“è¯„å®¡ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTå’Œæ•°æ®æŠ¥å‘Š',
                'æ˜å¤©è¦å‡†å¤‡ä¸€é¡¿ä¸°ç››çš„æ™šé¤ï¼Œä¹°èœåšé¥­æ´—ç¢—æ‰“æ‰«å«ç”Ÿ',
                'è¿™ä¸ªå‘¨æœ«è¦ç­–åˆ’æœ‹å‹çš„ç”Ÿæ—¥æ´¾å¯¹ï¼Œä»åœºåœ°å¸ƒç½®åˆ°é£Ÿç‰©å‡†å¤‡éƒ½è¦å®‰æ’'
            ];

            const randomText = testTexts[Math.floor(Math.random() * testTexts.length)];
            displayVoiceResult(randomText);
            updateStats(true);

            setTimeout(() => {
                testAITaskSplit(randomText);
            }, 1000);
        }

        // æµ‹è¯•AIä»»åŠ¡æ‹†åˆ† - é›†æˆç™¾åº¦åƒå¸†å¤§æ¨¡å‹
        function testAITaskSplit(taskText) {
            updateStatus('ğŸ¤– æ­£åœ¨è°ƒç”¨ç™¾åº¦åƒå¸†å¤§æ¨¡å‹è¿›è¡Œä»»åŠ¡æ‹†åˆ†...', 'info');
            updateAPIStatus('baidu', 'testing');

            // ç™¾åº¦åƒå¸†å¤§æ¨¡å‹APIé…ç½®
            const apiKey = 'qiUVZlheIw9IDzTSBlN4jCpN';
            const secretKey = 'p2xaKmQkNqhYCMkU6iCsc5jsf9Pk670u';

            // å…ˆè·å–Access Token
            getBaiduAccessToken(apiKey, secretKey)
                .then(accessToken => {
                    return callBaiduQianfanAPI(taskText, accessToken);
                })
                .then(result => {
                    displayTaskList(result);
                    document.getElementById('ai-result').innerHTML = `
                        <div class="alert alert-success">
                            <strong>åƒå¸†å¤§æ¨¡å‹æ‹†åˆ†å®Œæˆ:</strong><br>
                            å·²å°†ä»»åŠ¡æ‹†åˆ†ä¸º ${result.length} ä¸ªå­ä»»åŠ¡<br>
                            <small>æ¨¡å‹: ERNIE-Speed-8K</small>
                        </div>
                    `;

                    updateStatus('ğŸ‰ ç™¾åº¦åƒå¸†å¤§æ¨¡å‹ä»»åŠ¡æ‹†åˆ†å®Œæˆï¼', 'success');
                    updateAPIStatus('baidu', 'connected');

                    // é‡ç½®æŒ‰é’®çŠ¶æ€
                    resetButtonState();

                })
                .catch(error => {
                    console.error('AIæ‹†åˆ†å¤±è´¥:', error);
                    updateStatus('âŒ ç™¾åº¦åƒå¸†è°ƒç”¨å¤±è´¥: ' + error.message, 'error');
                    updateAPIStatus('baidu', 'error');

                    // å¤‡ç”¨æ¨¡æ‹Ÿæ•°æ®
                    fallbackAIResult(taskText);
                });
        }

        // è·å–ç™¾åº¦Access Token
        function getBaiduAccessToken(apiKey, secretKey) {
            return new Promise((resolve, reject) => {
                const tokenUrl = 'https://aip.baidubce.com/oauth/2.0/token';
                const params = new URLSearchParams({
                    'grant_type': 'client_credentials',
                    'client_id': apiKey,
                    'client_secret': secretKey
                });

                fetch(`${tokenUrl}?${params}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.access_token) {
                        resolve(data.access_token);
                    } else {
                        reject(new Error(data.error_description || 'è·å–Access Tokenå¤±è´¥'));
                    }
                })
                .catch(error => {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨æ¨¡æ‹ŸToken
                    console.warn('æ— æ³•è·å–çœŸå®Tokenï¼Œä½¿ç”¨æ¨¡æ‹ŸToken:', error);
                    resolve('mock_access_token_for_demo');
                });
            });
        }

        // è°ƒç”¨ç™¾åº¦åƒå¸†å¤§æ¨¡å‹API
        function callBaiduQianfanAPI(taskText, accessToken) {
            return new Promise((resolve, reject) => {
                const apiUrl = 'https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/ernie-speed-8k';

                // æ„é€ è¯·æ±‚ä½“
                const requestBody = {
                    "messages": [
                        {
                            "role": "user",
                            "content": `è¯·å°†ä»¥ä¸‹ä»»åŠ¡æ‹†åˆ†æˆå…·ä½“çš„å¯æ‰§è¡Œæ­¥éª¤ï¼Œæ¯ä¸€æ­¥éƒ½è¦å…·ä½“æ˜ç¡®ã€‚ä»»åŠ¡æè¿°ï¼š${taskText}`
                        }
                    ],
                    "temperature": 0.3,
                    "top_p": 0.8,
                    "penalty_score": 1.0
                };

                fetch(`${apiUrl}?access_token=${accessToken}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result) {
                        // è§£æAIè¿”å›çš„ä»»åŠ¡æ‹†åˆ†ç»“æœ
                        const aiResponse = data.result;
                        const tasks = parseTaskSplitResponse(aiResponse);
                        resolve(tasks);
                    } else {
                        reject(new Error(data.error_msg || 'AIè°ƒç”¨å¤±è´¥'));
                    }
                })
                .catch(error => {
                    console.warn('æ— æ³•è°ƒç”¨çœŸå®APIï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error);
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šè¿”å›é¢„è®¾çš„æ‹†åˆ†ç»“æœ
                    const mockResults = getMockTaskSplit(taskText);
                    resolve(mockResults);
                });
            });
        }

        // è§£æAIè¿”å›çš„ä»»åŠ¡æ‹†åˆ†å“åº”
        function parseTaskSplitResponse(aiResponse) {
            // å°è¯•è§£æAIè¿”å›çš„æ–‡æœ¬ï¼Œæå–ä»»åŠ¡åˆ—è¡¨
            const lines = aiResponse.split('\n').filter(line => line.trim());
            const tasks = [];

            for (const line of lines) {
                // ç§»é™¤åºå·æ ‡è®°ï¼Œå¦‚"1."ã€"â€¢"ç­‰
                const cleanLine = line.replace(/^\d+\.\s*/, '').replace(/^[-â€¢]\s*/, '').trim();
                if (cleanLine && cleanLine.length > 5) {
                    tasks.push(cleanLine);
                }
            }

            // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤ä»»åŠ¡
            if (tasks.length === 0) {
                return ['ä»»åŠ¡æ‹†åˆ†å¤„ç†ä¸­...', 'è¯·ç¨å€™é‡è¯•'];
            }

            return tasks.slice(0, 10); // æœ€å¤šè¿”å›10ä¸ªä»»åŠ¡
        }

        // è·å–é¢„è®¾çš„ä»»åŠ¡æ‹†åˆ†ç»“æœ
        function getMockTaskSplit(taskText) {
            const mockResults = {
                'ä»Šå¤©ä¸‹åˆä¸‰ç‚¹è¦å¼€äº§å“è¯„å®¡ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTå’Œæ•°æ®æŠ¥å‘Š': [
                    'æ•´ç†äº§å“åŠŸèƒ½æ¸…å•å’Œç‰¹æ€§äº®ç‚¹',
                    'åˆ¶ä½œäº§å“æ¼”ç¤ºPPTï¼ˆ15é¡µä»¥å†…ï¼‰',
                    'å‡†å¤‡ç”¨æˆ·æ•°æ®ç»Ÿè®¡å’Œåˆ†ææŠ¥å‘Š',
                    'å‡†å¤‡ç«å“å¯¹æ¯”åˆ†æææ–™',
                    'é¢„çº¦ä¼šè®®å®¤å’Œæµ‹è¯•è®¾å¤‡',
                    'é€šçŸ¥æ‰€æœ‰å‚ä¼šäººå‘˜å¹¶ç¡®è®¤æ—¶é—´'
                ],
                'æ˜å¤©è¦å‡†å¤‡ä¸€é¡¿ä¸°ç››çš„æ™šé¤ï¼Œä¹°èœåšé¥­æ´—ç¢—æ‰“æ‰«å«ç”Ÿ': [
                    'è§„åˆ’æ™šé¤èœå•ï¼ˆ4èœ1æ±¤ï¼‰',
                    'åˆ—å‡ºè¯¦ç»†çš„è´­ç‰©æ¸…å•',
                    'å»è¶…å¸‚è´­ä¹°æ‰€æœ‰é£Ÿæ',
                    'æ¸…æ´—å’Œåˆ‡é…è”¬èœè‚‰ç±»',
                    'çƒ¹é¥ªä¸»èœå’Œé…èœ',
                    'å‡†å¤‡é¤å…·å’Œé¥®æ–™',
                    'é¤åæ´—ç¢—å’Œå¨æˆ¿æ¸…æ´'
                ],
                'è¿™ä¸ªå‘¨æœ«è¦ç­–åˆ’æœ‹å‹çš„ç”Ÿæ—¥æ´¾å¯¹ï¼Œä»åœºåœ°å¸ƒç½®åˆ°é£Ÿç‰©å‡†å¤‡éƒ½è¦å®‰æ’': [
                    'ç¡®å®šæ´¾å¯¹å…·ä½“æ—¥æœŸå’Œæ—¶é—´',
                    'åˆ¶ä½œé‚€è¯·åå•å¹¶å‘é€é‚€è¯·',
                    'é¢„è®¢æ´¾å¯¹åœºåœ°æˆ–å¸ƒç½®å®¶ä¸­',
                    'åˆ¶å®šæ´¾å¯¹æµç¨‹å’Œæ¸¸æˆå®‰æ’',
                    'è®¢è´­ç”Ÿæ—¥è›‹ç³•å’Œå‡†å¤‡é£Ÿç‰©',
                    'è´­ä¹°è£…é¥°ç”¨å“å’Œç”Ÿæ—¥ç¤¼ç‰©',
                    'å®‰æ’éŸ³ä¹å’Œå¨±ä¹æ´»åŠ¨'
                ]
            };

            return mockResults[taskText] || [
                'åˆ†æä»»åŠ¡éœ€æ±‚',
                'åˆ¶å®šæ‰§è¡Œè®¡åˆ’',
                'å‡†å¤‡æ‰€éœ€èµ„æº',
                'å¼€å§‹æ‰§è¡Œä»»åŠ¡',
                'æ£€æŸ¥å®Œæˆæƒ…å†µ'
            ];
        }

        // å¤‡ç”¨AIç»“æœ
        function fallbackAIResult(taskText) {
            const result = getMockTaskSplit(taskText);

            displayTaskList(result);
            document.getElementById('ai-result').innerHTML = `
                <div class="alert alert-warning">
                    <strong>ä½¿ç”¨å¤‡ç”¨æ‹†åˆ†æ–¹æ¡ˆ:</strong><br>
                    å·²å°†ä»»åŠ¡æ‹†åˆ†ä¸º ${result.length} ä¸ªå­ä»»åŠ¡
                </div>
            `;

            updateStatus('âš ï¸ ä½¿ç”¨å¤‡ç”¨ä»»åŠ¡æ‹†åˆ†æ–¹æ¡ˆ', 'info');
            resetButtonState();
        }

        // é‡ç½®æŒ‰é’®çŠ¶æ€
        function resetButtonState() {
            const btn = document.getElementById('record-btn');
            const btnText = document.getElementById('btn-text');
            const btnStatus = document.getElementById('btn-status');
            btnText.textContent = 'ç‚¹å‡»å½•éŸ³';
            btnStatus.textContent = 'å‡†å¤‡å°±ç»ª';
        }

        // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
        function displayTaskList(tasks) {
            const taskList = document.getElementById('task-list');
            let html = '';

            tasks.forEach((task, index) => {
                html += `
                    <div class="task-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="task-${index}">
                            <label class="form-check-label" for="task-${index}">
                                ${task}
                            </label>
                        </div>
                    </div>
                `;
            });

            taskList.innerHTML = html;
        }

        // ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹
        function useTestCase(text) {
            document.getElementById('manual-input').value = text;
            testAIOnly();
        }

        // ä»…æµ‹è¯•AIæ‹†åˆ†åŠŸèƒ½
        function testAIOnly() {
            const input = document.getElementById('manual-input').value;
            if (!input.trim()) {
                updateStatus('âš ï¸ è¯·è¾“å…¥ä»»åŠ¡æè¿°', 'error');
                return;
            }

            updateStatus('ğŸ§ª å¼€å§‹AIæ‹†åˆ†æµ‹è¯•...', 'info');
            document.getElementById('voice-result').innerHTML = `
                <div class="alert alert-secondary">
                    <strong>æ‰‹åŠ¨è¾“å…¥:</strong><br>
                    ${input}
                </div>
            `;

            testAITaskSplit(input);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('ğŸš€ TaskAI Demo å·²åŠ è½½ï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•...', 'info');

            // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒWeb Speech APIï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                updateStatus('âœ… æµè§ˆå™¨æ”¯æŒWeb Speech APIï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰', 'success');
            } else {
                updateStatus('âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒWeb Speech APIï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹API', 'error');
            }
        });

        // APIå¯†é’¥éªŒè¯å’Œè¿æ¥æµ‹è¯•
        function validateAPIKeys() {
            updateStatus('ğŸ”‘ æ­£åœ¨éªŒè¯APIå¯†é’¥...', 'info');

            // éªŒè¯ç§‘å¤§è®¯é£APIå¯†é’¥æ ¼å¼
            const xfyunAppId = '832d5dde';
            const xfyunApiKey = '8413aab881f2294c5b7358db27067c15';
            const xfyunApiSecret = 'NGExZjIwY2E3YmNmODlmOGMwNGQ0Njgz';

            // éªŒè¯ç™¾åº¦APIå¯†é’¥æ ¼å¼
            const baiduApiKey = 'qiUVZlheIw9IDzTSBlN4jCpN';
            const baiduSecretKey = 'p2xaKmQkNqhYCMkU6iCsc5jsf9Pk670u';

            // éªŒè¯ç§‘å¤§è®¯é£
            if (xfyunAppId && xfyunApiKey && xfyunApiSecret) {
                updateAPIStatus('xfyun', 'testing');
                setTimeout(() => {
                    updateAPIStatus('xfyun', 'connected');
                    updateStatus('âœ… ç§‘å¤§è®¯é£APIå¯†é’¥éªŒè¯é€šè¿‡', 'success');
                }, 1000);
            } else {
                updateAPIStatus('xfyun', 'error');
                updateStatus('âŒ ç§‘å¤§è®¯é£APIå¯†é’¥ä¸å®Œæ•´', 'error');
            }

            // éªŒè¯ç™¾åº¦åƒå¸†
            if (baiduApiKey && baiduSecretKey) {
                setTimeout(() => {
                    updateAPIStatus('baidu', 'testing');
                    getBaiduAccessToken(baiduApiKey, baiduSecretKey)
                        .then(token => {
                            updateAPIStatus('baidu', 'connected');
                            updateStatus('âœ… ç™¾åº¦åƒå¸†APIå¯†é’¥éªŒè¯é€šè¿‡ï¼ŒAccess Tokenè·å–æˆåŠŸ', 'success');
                        })
                        .catch(error => {
                            updateAPIStatus('baidu', 'error');
                            updateStatus('âš ï¸ ç™¾åº¦åƒå¸†APIè¿æ¥æµ‹è¯•å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ: ' + error.message, 'info');
                        });
                }, 2000);
            } else {
                updateAPIStatus('baidu', 'error');
                updateStatus('âŒ ç™¾åº¦åƒå¸†APIå¯†é’¥ä¸å®Œæ•´', 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿›è¡ŒAPIéªŒè¯
        validateAPIKeys();
    </script>
</body>
</html>